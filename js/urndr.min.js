var URNDR={revision:"2"};URNDR.COMMAND_MODULE="COMMAND_MODULES";URNDR.STYLE_MODULE="STYLE_MODULES";URNDR.POINT_MODULE="POINT_MODULES";URNDR.STROKE_MODULE="STROKE_MODULES";
URNDR.DRAW_MODULE="DRAW_MODULES";URNDR.CanvasManager=function(){this.list={};};URNDR.CanvasManager.prototype={get widthfunction(){return this.get(0).element.width;
},get heightfunction(){return this.get(0).element.height;},add:function(c,a,b){this.list[a]={};this.list[a].element=c;this.list[a].context=c.getContext(b);
},get:function(a){if(this.list.hasOwnProperty(a)){return this.list[a];}else{if(typeof a==="number"){return this.list[Object.keys(this.list)[a]];}else{return 0;
}}},each:function(a){for(var b in this.list){a(this.list[b]);}},resize:function(a,b){if(a==undefined){a=this.width;}if(b==undefined){b=this.width;}this.each(function(e){var c=e.context.lineCap,d=e.context.lineJoin;
e.element.width=a;e.element.height=b;e.context.lineCap=c;e.context.lineJoin=d;});},clear:function(c){var b=this.width;var e=this.height;this.each(function(a){d(a.context);
});function d(a){if(c===1){a.clearRect(0,0,b,e);}else{a.save();a.globalAlpha=c;a.globalCompositeOperation="destination-out";a.fillRect(0,0,b,e);a.restore();
}}},set lineCapfunction(a){this.each(function(b){b.context.lineCap=a;});},set lineJoinfunction(a){this.each(function(b){b.context.lineJoin=a;});}};URNDR.QuadTree=function(b,a){this.MAX_OBJECTS=20;
this.MAX_LEVELS=5;this.level=b;this.objects=[];this.bounds=a;this.nodes=[null,null,null,null];};URNDR.QuadTree.prototype={clear:function(){this.objects=[];
for(var b=0,a=this.nodes.length;b<a;b++){if(this.nodes[b]!==null){this.nodes[b].clear();this.nodes[b]=null;}}},split:function(){var b,d,a,g,c;c=this.level+1;
b=this.bounds.width/2;d=this.bounds.height/2;a=this.bounds.x;g=this.bounds.y;var f=URNDR.QuadTree,e=URNDR.Rectangle;this.nodes[0]=new f(c,new e(a+b,g,b,d));
this.nodes[1]=new f(c,new e(a,g,b,d));this.nodes[2]=new f(c,new e(a,g+d,b,d));this.nodes[3]=new f(c,new e(a+b,g+d,b,d));},getIndex:function(e){var b,a,c,d,f;
b=-1;a=this.bounds.x+this.bounds.width*0.5;c=this.bounds.y+this.bounds.height*0.5;d=e.y<c&&e.y+e.height<c;f=e.y>c;if(e.x<a&&e.x+e.width<a){if(d){b=1;}else{if(f){b=2;
}}}else{if(e.x>a){if(d){b=0;}else{if(f){b=3;}}}}return b;},insert:function(c){if(this.nodes[0]){var a=this.getIndex(c);if(a!==-1){return this.nodes[a].insert(c);
}}this.objects.push(c);if(this.objects.length>this.MAX_OBJECTS&&this.level<this.MAX_LEVELS){if(!this.nodes[0]){this.split();}var b=0;while(b<this.objects.length){var a=this.getIndex(this.objects[b]);
if(a!==-1){this.nodes[a].insert(this.objects.splice(b,1)[0]);}else{b++;}}}},retrieve:function(a,c){var b=this.getIndex(c);if(b!==-1&&this.nodes[0]){a=a.concat(this.nodes[b].retrieve(a,c));
}a=a.concat(this.objects);return a;}};URNDR.Rectangle=function(a,e,b,c,d){this.x=a;this.y=e;this.width=b;this.height=c;this.reference=d||undefined;};URNDR.Module=function(i,f,c,h){var b,d,g,a;
if(h==undefined){a=false;if(typeof c=="number"){g=c;}else{a=c;g=false;}}else{a=h;g=c;}d=f;b=i;this.id="MOD-"+THREE.Math.generateUUID();this.priority=1;
this.enabled=a;this.type=d;this.name=b;this.timeControlObject={then:Date.now(),interval:25};this.func=function(){};if(d!=URNDR.COMMAND_MODULE){this.listener=function(){};
}if(g){this.keyCode=g;}};URNDR.Module.prototype={get timeControlfunction(){var b=this.timeControlObject,a=Date.now(),c=a-b.then;if(c<b.interval){return false;
}else{b.then=a-(c%b.interval);return true;}},set intervalfunction(a){this.timeControlObject.interval=a;},set settingsfunction(a){this.configuration=a;this.initialConfiguration=Object.create(a);
},get settingsfunction(){return this.configuration;},setFunction:function(a){this.func=a;},getFunction:function(){return this.func;},setConfiguration:function(a){this.configuration=a;
this.initialConfiguration=Object.create(this.configuration);},getConfiguration:function(){return this.configuration;},receive:function(a){return this.listener.apply(this,a);
}};URNDR.ModuleManager=function(){this.modules={};this[URNDR.COMMAND_MODULE]={};this[URNDR.STYLE_MODULE]={};this[URNDR.POINT_MODULE]={};this[URNDR.STROKE_MODULE]={};
this[URNDR.DRAW_MODULE]={};this.KEY_PREFIX="key";this.key_map={};this.counter=0;this.setKeyMap=function(a,b){this.key_map[this.KEY_PREFIX+a]=b;};this.getModuleIDbyKey=function(b){var a=this.key_map[this.KEY_PREFIX+b];
return(a?a:false);};this.loadModule=function(a){if(a instanceof URNDR.Module===false){if(typeof a==="function"){a=a();}else{if(typeof a==="object"){return 0;
}}}this.modules[a.id]=a;if(this.hasOwnProperty(a.type)){this[a.type][a.id]=this.modules[a.id];}if(typeof a.keyCode==="number"){this.setKeyMap(a.keyCode,a.id);
}};this.loadModules=function(b){for(var a in b){this.loadModule(b[a]);}};this.getModule=function(a){return this.modules[a];};this.getModuleByName=function(b){for(var a in this.modules){if(b===this.modules[a].name){return this.modules[a];
}}return false;};this.trigger=function(a){var d=a.keyCode||a.charCode,c=this.getModuleIDbyKey(d);if(c){c=this.getModule(c);var b={module:c};switch(c.type){case URNDR.COMMAND_MODULE:b.message=c.func(a);
break;case URNDR.DRAW_MODULE:this.soloModule(c);b.message="Activated";break;default:c.enabled=!c.enabled;_msg=c.receive(a);b.message=c.enabled?"ON":"OFF";
if(_msg){b.message+=" : "+_msg;}break;}return b;}else{return 0;}};this.soloModule=function(b){var c=this[b.type];for(var a in c){c[a].enabled=(c[a].id===b.id)?true:false;
}};this.runEnabledModulesInList=function(b,e){var d=this[b];var a,c;for(a in d){c=d[a];if(c.enabled){if(c.timeControl){c.func(e);}}}};this.getEnabledModulesCount=function(a){var c=this[a],b=0;
for(m in c){if(c[m].enabled){b++;}}return b;};};URNDR.Strokes=function(a){this.strokes={};this.strokesHistory=[];this.strokesZDepth=[];this.active_stroke=0;
this.canvas=a;};URNDR.Strokes.prototype={get strokeCountfunction(){return this.strokesHistory.length;},reset:function(){this.strokes={};this.strokesHistory=[];
this.strokesZDepth=[];this.active_stroke=0;this.quadTree.clear();},rebuildQuadTree:function(){var a=this.canvas.canvasWidth||window.innerWidth,b=this.canvas.canvasHeight||window.innerWidth;
this.quadTree=new URNDR.QuadTree(1,new URNDR.Rectangle(0,0,a,b));this.eachStroke(function(d,c){c.addToQuadTree(d);},this);},addToQuadTree:function(c){var b,a,d=this.quadTree;
if(c instanceof URNDR.Stroke){c.eachPoint(function(g,f,e){d.insert(new URNDR.Rectangle(g.X,g.Y,1,1,{stroke:f,pointIndex:e,point:g}));},c);}},getFromQuadTree:function(f,d,g,b){if(!f||!d){return 0;
}_w=g||2;_h=b||2;_x=f-_w*0.5;_y=d-_h*0.5;var e=new URNDR.Rectangle(_x,_y,_w,_h);var i=this.quadTree.retrieve([],e);var j=[];for(var a=0,c=i.length;a<c;
a++){j.push(i[a]);}return j;},getActiveStroke:function(){if(this.active_stroke!==0){return this.getStrokeByID(this.active_stroke);}else{return 0;}},selectStrokeByID:function(a){if(this.strokes.hasOwnProperty(a)){this.active_stroke=a;
}else{return false;}},getLatestStroke:function(){return this.getStrokeByID(this.strokesHistory[this.strokesHistory.length-1]);},beginNewStroke:function(){this.selectStrokeByID(this.addStroke());
},addStroke:function(){var c=arguments.length;if(c===0){return this.addStroke(new URNDR.Stroke());}else{if(c>1){for(var a=0;a<c;a++){this.addStroke(arguments[a]);
}}else{if(c===1){var b=arguments[0];if(b instanceof URNDR.Stroke){b.parent=this;this.strokes[b.id]=b;this.strokesHistory.push(b.id);this.strokesZDepth.push(b.id);
return b.id;}}}}},getStrokeByID:function(a){if(this.strokes.hasOwnProperty(a)){return this.strokes[a];}else{return 0;}},deleteStrokeByID:function(c){if(this.strokes.hasOwnProperty(c)){var b=this.strokesHistory.indexOf(c);
var a=this.strokesZDepth.indexOf(c);if(b>=0){this.strokesHistory.splice(b,1);}if(a>=0){this.strokesZDepth.splice(a,1);}if(b===-1||a===-1){this.checkConsistency(c);
}delete this.strokes[c];}},checkConsistency:function(f){console.log("PART I : Start to check consistency in the data. ");if(f){console.log("Check stroke by ID...");
if(this.strokes.hasOwnProperty(f)){var b=this.strokesHistory.indexOf(f);var a=this.strokesZDepth.indexOf(f);console.log("Index in History Array: "+b,"Index in Z-Depth Array: "+a);
console.log("Something wrong? ",b===a?"NO :)":"YES :(");}else{console.log("no such stroke present. ");}}console.log("PART II : Check Data Length");var d,c,e;
d=Object.keys(strokes).length;c=this.strokesHistory.length;e=this.strokesZDepth.length;if(d===c===e){console.log("");}else{console.log("Warning to developer : there's inconsistency between strokes and other two arrays! (slen,hlen,zlen) = (",d,c,e,")");
}},eachStroke:function(c,e){var b=this.strokeCount;var a=this.strokesHistory.slice(0);for(var d=0;d<b;d++){c(this.getStrokeByID(a[d]),e,d);}}};URNDR.Stroke=function(a){this.id="S-"+THREE.Math.generateUUID();
this.tags=a||{};this.points=[];this.parent=undefined;this.closed=false;this.center=undefined;this.start=0;this.end=1;this.link="";this.hovered=false;this.selected=false;
this._flag_to_delete=false;};URNDR.Stroke.prototype={get lengthfunction(){return this.points.length;},get flag_to_deletefunction(){if(this.length<1){return false;
}if(this._flag_to_delete===true){return true;}var a=0;var b=true;this.eachPoint(function(d){a+=d.A;if(b){var c=d.ndc;if(c.x>-1&&c.x<1&&c.y>-1&&c.y<1){b=false;
}}});if(b){return true;}if(a<0.05){return true;}else{return false;}},deleteStroke:function(){this._flag_to_delete=true;},addPoint:function(a){if(a instanceof URNDR.Point){a.parent=this;
this.points.push(a);}else{a=a!=undefined?a:{parent:this};this.points.push(new URNDR.Point(a));}},getPoint:function(a){if(a>=0&&a<this.length){return this.points[a];
}else{return 0;}},getTrack:function(c){var b,a;b=this.length;a=[];if(b===0){return a;}if(this.getPoint(0).hasOwnProperty(c)===false){return 0;}for(var d=0;
d<b;d++){a.push(this.getPoint(d)[c]);}return a;},setTrack:function(c,b){var a=this.length;if(a!==b.length){return 0;}for(var d=0;d<a;d++){this.getPoint(d)[c]=b[d];
}},removePoint:function(a){if(a>=0&&a<this.length){this.points.splice(a,1);}},simplify:function(d){function f(j,i){var h=j.X-i.X,g=j.Y-i.Y;return h*h+g*g;
}function e(l,n,k){var g=n.X,o=n.Y,i=k.X-g,h=k.Y-o;if(i!==0||h!==0){var j=((l.X-g)*i+(l.Y-o)*h)/(i*i+h*h);if(j>1){g=k.X;o=k.Y;}else{if(j>0){g+=i*j;o+=h*j;
}}}i=l.X-g;h=l.Y-o;return i*i+h*h;}function b(n,k){var j=n[0],o=[j],h;for(var l=1,g=n.length;l<g;l++){h=n[l];if(f(h,j)>k){o.push(h);j=h;}}if(j!==h){o.push(h);
}return o;}function a(t,g){var p=t.length,r=typeof Uint8Array!=="undefined"?Uint8Array:Array,h=new r(p),n=0,s=p-1,q=[],u=[],k,j,l,o;h[n]=h[s]=1;while(s){j=0;
for(k=n+1;k<s;k++){l=e(t[k],t[n],t[s]);if(l>j){o=k;j=l;}}if(j>g){h[o]=1;q.push(n,o,o,s);}s=q.pop();n=q.pop();}for(k=0;k<p;k++){if(h[k]){u.push(t[k]);}}return u;
}function c(i,g,j){if(i.length<=1){return i;}var h=g!==undefined?g*g:1;i=j?i:b(i,h);i=a(i,h);return i;}d=d===undefined||d<0?0.7:d;this.points=c(this.points,d,true);
},simplify_more:function(a){a=a<0||a===undefined?30:a;this.optimize(a);},optimize:function(c){if(this.length>3){var d=this.points[this.length-1],b=this.points[0];
if(d.distanceToSquared(b)<360){this.closed=true;}}this.simplify();this.center=this.calculateCenterOfPoints();},calculateCenterOfPoints:function(){var a={x:0,y:0},b=1/this.length;
this.eachPoint(function(e,d,c){a.x+=e.X;a.y+=e.Y;},null);a.x*=b;a.y*=b;return a;},setTag:function(a,b){this.tags[a]=b;},getTag:function(a){if(this.tags.hasOwnProperty(a)){return this.tags[a];
}else{return undefined;}},eachPoint:function(c,e){var b=this.points.slice(0);for(var d=0,a=this.length;d<a;d++){c(b[d],e,d);}},getNearestPointWith:function(j,d){if(this.length<2){return 0;
}if(this.getPoint(d).hasOwnProperty(j)===false){return 0;}var c=this.getTrack(j),f=c.length,i,g,e,h,k;i=e=false;k={before:0,before_distance:Infinity,after:0,after_distance:Infinity};
for(g=d-1;g>=0;g--){if(c[g]!=null){i=g;break;}}for(h=d;h<f;h++){if(c[h]!=null){e=h;break;}}if(i!=false){k.before=this.getPoint(i);k.before_distance=d-i;
}if(e!=false){k.after=this.getPoint(e);k.after_distance=e-d;}if(k.before_distance<k.after_distance){k.nearest=k.before;k.nearest_distance=k.before_distance;
}else{k.nearest=k.after;k.nearest_distance=k.after_distance;}return k;}};URNDR.Point=function(a){this.parent=undefined;this.X=-100;this.Y=-100;this.S=0;
this.R=0;this.G=0;this.B=0;this.A=0;this.OBJECT=null;this.FACE=null;this.BU=1;this.BV=0;this.BW=0;this.PX=0;this.PY=0;this.updatePoint(a);};URNDR.Point.prototype={get ndcfunction(){var c,d;
if(this.parent&&this.parent.parent){c=this.parent.parent.canvas.width;d=this.parent.parent.canvas.height;}else{c=window.innerWidth;d=window.innerHeight;
}var b=URNDR.Math.pixelToCoordinate(this.X,this.Y,c,d);return new THREE.Vector2(b.x,b.y);},get bindedfunction(){return(this.OBJECT&&this.FACE)?true:false;
},set bindedfunction(a){if(a===false){this.OBJECT=null;this.FACE=null;this.BU=0;this.BV=0;this.BW=0;this.PX=0;this.PY=0;}else{}},get xfunction(){return this.X;
},get yfunction(){return this.Y;},set xfunction(a){this.X=a;},set yfunction(a){this.Y=a;},distanceToSquared:function(c){var b=this.X-c.X,a=this.Y-c.Y;return b*b+a*a;
},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a));},updatePoint:function(a){for(var b in a){if(this.hasOwnProperty(b)){this[b]=a[b];
}}},refreshBinding:function(k){U3.raycaster.setFromCamera(new THREE.Vector2(this.ndc.x,this.ndc.y),k.camera);var d=k.raycaster.intersectObjects(k.scene.children);
var f=[];d.forEach(function(a){if(a.object.visible){f.push(a);}});if(f.length>0){var e=f[0].object,h=f[0].face;var l=e.localToWorld(e.getMorphedVertex(h.a)).project(k.camera),j=e.localToWorld(e.getMorphedVertex(h.b)).project(k.camera),i=e.localToWorld(e.getMorphedVertex(h.c)).project(k.camera),g=URNDR.Math.getBarycentricCoordinate(this.ndc,l,j,i);
this.OBJECT=e;this.FACE=h;this.BU=g[0];this.BV=g[1];this.BW=g[2];}else{this.binded=false;}}};URNDR.Pen=function(d,a,b){this.x=0;this.y=0;this.pressure=0;
this.isDown=0;this.active_tool=0;this.tools={};this.canvas=d;this.canvas_hud=a;this.wacom=b;this.onmousedown=function(f,e){f.isDown=1;if(f.active_tool instanceof URNDR.PenTool){f.active_tool.onmousedown(f,e);
}};this.onmouseup=function(f,e){f.isDown=0;if(f.active_tool instanceof URNDR.PenTool){f.active_tool.onmouseup(f,e);}};this.onmousemove=function(g,e){var f=this.canvas.getBoundingClientRect();
this.x=e.clientX-f.left;this.y=e.clientY-f.top;this.pressure=g.wacom.pressure;if(g.active_tool instanceof URNDR.PenTool){g.active_tool.onmousemove(g,e);
}};this.onmouseout=function(f,e){f.isDown=0;f.active_tool.onmouseout(f,e);};var c=this;a.addEventListener("mousedown",function(e){c.onmousedown(c,e);});
a.addEventListener("mouseup",function(e){c.onmouseup(c,e);});a.addEventListener("mousemove",function(e){c.onmousemove(c,e);});a.addEventListener("mouseout",function(e){c.onmouseout(c,e);
});};URNDR.Pen.prototype={get ndc_xfunction(){return THREE.Math.mapLinear(this.x,0,this.canvas.width,-1,1);},get ndc_yfunction(){return THREE.Math.mapLinear(this.y,0,this.canvas.height,1,-1);
},get ndcfunction(){return[this.ndc_x,this.ndc_y];},set ndcfunction(a){var b=URNDR.Math.coordinateToPixel(a[0],a[1],this.canvas.width,this.canvas.height);
this.x=b.x;this.y=b.y;},selectToolByID:function(a){if(this.tools.hasOwnProperty(a)){if(this.active_tool instanceof URNDR.PenTool){this.active_tool.disengage();
}this.active_tool=this.tools[a];this.active_tool.engage();}},selectToolByName:function(b){for(var a in this.tools){if(this.tools[a].name===b){if(this.active_tool instanceof URNDR.PenTool){this.active_tool.disengage();
}this.active_tool=this.tools[a];this.active_tool.engage();return true;}}return false;},addTool:function(a,b){this.tools[a.id]=a;if(b){this.selectToolByID(a.id);
}}};URNDR.PenTool=function(b){this.id="T-"+THREE.Math.generateUUID();this.name=b.name||"Untitled Tool";this.onmousedown=b.onmousedown||function(){};this.onmouseup=b.onmouseup||function(){};
this.onmousemove=b.onmousemove||function(){};this.onmouseout=b.onmouseout||function(){};this.engage=b.engage||function(){};this.disengage=b.disengage||function(){};
this.size=b.size||5;for(var c in b){var a=true;for(var d in ["id","name","onmousedown","onmouseup","onmousemove","size"]){if(c===d){a=false;}}if(a===true){this[c]=b[c];
}}};URNDR.Hud=function(a){this.muted=false;this.box=a;this.style={prefix:'<div class="argument">',suffix:"</div>",space:""};};URNDR.Hud.prototype={display:function(){if(this.muted){return;
}this.box.innerHTML=this.wrap(arguments[0]);for(var a=1;a<arguments.length;a++){this.box.innerHTML+=this.style.space+this.wrap(arguments[a]);}},appendToDisplay:function(){if(this.muted){return;
}for(var a=0;a<arguments.length;a++){this.box.innerHTML+=this.style.space+this.wrap(arguments[a]);}},wrap:function(a){return this.style.prefix+a+this.style.suffix;
},clear:function(){this.box.innerHTML=null;},position:function(c,b){var a=this.box.style;a.left=c||a.left;a.top=b||a.top;}};URNDR.StrokeStyle=function(){this.cap="round";
this.join="round";this.composit="source-over";this.brush_size=40;this.color=[0,0,255,1];};URNDR.StrokeStyle.prototype={gradientMaker:function(a,d,c,b){var e=a.createLinearGradient(d.X,d.Y,c.X,c.Y);
e.addColorStop(0,"rgba("+d.R+","+d.G+","+d.B+","+d.A*b+")");e.addColorStop(1,"rgba("+c.R+","+c.G+","+c.B+","+c.A*b+")");return e;}};URNDR.Model=function(a){this.id="MODEL-"+THREE.Math.generateUUID();
this.name="";this.tags={};this.file_path="";this.loader=new THREE.JSONLoader();this.mesh=undefined;this.geometry=undefined;this.material=a.material;this.animation={play:function(){},stop:function(){},pause:function(){},update:function(){}};
this.init=a.init||function(){};this.onfocus=a.onfocus||function(){};this.onblur=a.onblur||function(){};this.onframe=a.onframe||function(){};};URNDR.Model.prototype={get activefunction(){if(this.mesh){return this.mesh.visible;
}else{return false;}},set activefunction(b){var a=null;if(this.mesh){a=this.mesh.visible;this.mesh.visible=b;}else{this._active=b;}if(a!==null&&a!==b){if(b){this.onfocus();
}else{this.onblur();}}},loadModel:function(b,c){this.file_path=b;var a=this;this.loader.load(this.file_path,function(e,d){a.geometry=e;if(d){a.material=d;
}a.mesh=new THREE.Mesh(a.geometry,a.material);if(a._active!==undefined){a.active=a._active;delete a._active;}else{a.active=true;}a.init(a);a.onfocus();
c(a);});},update:function(a){if(this.active){if(this.animation){this.animation.update(a);}}},};URNDR.ThreeManager=function(a){this.models={};this.models_array=[];
this.activeModel=0;this.renderer=new THREE.WebGLRenderer({canvas:a.canvas,precision:"lowp",alpha:true});this.camera=new THREE.PerspectiveCamera(75,1,1,500);
this.scene=new THREE.Scene();if(a.fog){this.scene.fog=a.fog;}this.raycaster=new THREE.Raycaster();this.material=a.material||new THREE.MeshBasicMaterial({morphTargets:true,color:204});
this.material.index0AttributeName="position";this.rig={radius:5,target_radius:5,theta:0,target_theta:0,pitch:0,target_pitch:0,speed:0.1,focus:new THREE.Vector3(0,0,0),_focus:new THREE.Vector3(0,0,0)};
this.speed=15;this.camera.position.set(0,0,5);};URNDR.ThreeManager.prototype={get countfunction(){return this.models_array.length;},createModelFromFile:function(d,b){b.material=b.material||this.material;
var a=new URNDR.Model(b);this.addModel(a);var c=this;a.loadModel(d,function(){c.scene.add(a.mesh);c.solo(a);});},addModel:function(a){a.parent=this;this.models[a.id]=a;
this.models_array.push(a.id);},getModel:function(a){if(typeof a==="string"){if(this.models.hasOwnProperty(a)){return this.models[a];}else{return -1;}}else{if(typeof a==="number"){if(a>=0&&a<this.models_array.length){return this.getModel(this.models_array[a]);
}else{return -1;}}else{return this.getModel(this.count-1);}}},eachModel:function(a,c){for(var b in this.models){a(this.getModel(b),c,b);}},solo:function(c){var a=this;
if(typeof c==="number"){a.models_array.forEach(function(e,d){if(d===c){a.activeModel=c;a.models[e].active=true;}else{a.models[e].active=false;}});}else{if(typeof c==="string"){var b=a.models_array.indexOf(c);
if(b!==-1){this.solo(b);}}else{if(c instanceof URNDR.Model){this.solo(c.id);}}}},update:function(){var b=this;b.eachModel(function(d,e){if(d.active){d.update(e.speed);
}},b);var a=this.rig;var c=6.283185247;if(a.theta>=c){a.theta-=c;a.target_theta-=c;}else{if(a.theta<-c){a.theta+=c;a.target_theta+=c;}}a.theta+=(a.target_theta-a.theta)*a.speed;
a.pitch+=(a.target_pitch-a.pitch)*a.speed;a.radius+=(a.target_radius-a.radius)*a.speed;a._focus.lerp(a.focus,a.speed);U3.camera.position.z=Math.sin(a.theta)*a.radius;
U3.camera.position.x=Math.cos(a.theta)*a.radius;U3.camera.position.y=a.pitch;U3.camera.lookAt(a._focus);b.renderer.render(this.scene,this.camera);}};URNDR.Math={pixelToCoordinate:function(a,d,b,c){return{x:THREE.Math.mapLinear(a,0,b,-1,1),y:THREE.Math.mapLinear(d,0,c,1,-1)};
},coordinateToPixel:function(a,d,b,c){return{x:(a/2+0.5)*b,y:-(d/2-0.5)*c};},getBarycentricCoordinate:function(d,l,j,i){var r,o,k,z,t,h,f,e,g,s,q,n;r=new THREE.Vector2(j.x-l.x,j.y-l.y);
o=new THREE.Vector2(i.x-l.x,i.y-l.y);k=new THREE.Vector2(d.x-l.x,d.y-l.y);z=r.dot(r);t=r.dot(o);h=o.dot(o);f=k.dot(r);e=k.dot(o);g=1/(z*h-t*t);q=(h*f-t*e)*g;
n=(z*e-t*f)*g;s=1-q-n;return[s,q,n];},random:function(b,c){if(!b){b=1;}var a=b*Math.random();if(c){if(c.round){a=Math.round(a);}}return a;}};URNDR.Helpers={randomizeArray:function(a,c){if(!c){c=10;
}var e=c*0.5;for(var d=0,b=a.length;d<b;d++){a[d]+=e-Math.random()*c;}return a;}};THREE.Object3D.prototype.getMorphedVertex=function(d){var g=this.geometry,h=this.morphTargetInfluences;
if(h&&g.morphTargets){if(g.morphTargets.length>0){var b=new THREE.Vector3(),f=0;for(var e=0,a=g.morphTargets.length;e<a;e++){var c=g.morphTargets[e].vertices[d];
b.x+=c.x*h[e];b.y+=c.y*h[e];b.z+=c.z*h[e];f+=h[e];}if(f!=0){return b;}}}return g.vertices[d].clone();};THREE.Camera.prototype.checkVisibility=function(d,b){if(d.visible===false){return 0;
}var c=THREE.Math.mapLinear,g=THREE.Math.clamp;var f=new THREE.Matrix3().getNormalMatrix(d.matrixWorld),e=b.normal.clone().applyMatrix3(f).negate(),a=new THREE.Vector3(0,0,-1).applyQuaternion(this.quaternion);
return g(c(a.angleTo(e),1.2,1.4,1,0),0,1);};THREE.MorphAnimation.prototype.stop=function(){this.pause();this.currentFrame=1;this.currentTime=0;for(var b=0;
b<this.frames;b++){this.mesh.morphTargetInfluences[b]=0;}this.mesh.morphTargetInfluences[0]=1;};